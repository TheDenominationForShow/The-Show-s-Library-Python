# showlib的python版本

## 借鉴

主要思考git和mqtt的模式

## 想法

尽可能地减少资源的占用，减少不必要的传输和规范

## 设计

### 客户端设计

#### SL_Storage

建立仓库配置文件，生成当前仓库的guid，

对资源进行定位，并存入数据库

* create_storage        创建仓库
* open_storage          打开仓库
* delete_stroage        删除仓库

* add_path              添加管理路径
* del_path              删除管理路径
* scan_path             扫描并记录

#### SL_Signature
    
    对资源进行签名，并插入到数据库，暂定sqlite

* GetFileHash   签名
* GenRecord     生成记录
* InsertToDB    记录存库

#### SL_History

#### SL_Manage_Signature

从签名库中读取，插入，发布，订阅

* GetRecords
* InertRecord
* InertRecords
* 

#### SL_Manage_Resource
从资源库中读取，定位，发布，订阅
#### SL_Manage_Storage

#### SL_Client

* Publish_Signature
* Publish_Storage
* SubcribeBySignature
* SubcribeByStorage

#### SL_Config

用于存储和读取系列化文件

### 服务端设计

#### SL_Server

### 数据库设计

## 记录

* 2019-11-20,需要增加扫描文件的过滤器，不然会把db文件也给扫描
* 2019-11-23,现在的处理是，扫描root，得到某个文件名，hash，生成记录，存库。这样没有把cpu用起来。后续应该是，集中扫描文件名，多线程hash，生成记录，存库
* 2019-11-23 10:52 发现了昨天的问题。
    * 锁库是因为我没有调用commit。大量的请求没有结束
    * 其次优化的问题可以放弃了，因为我发现我没有对大文件全部hash，先前只是hash文件的前512字节。全部hash之后，对大文件来说发现最大的瓶颈是`磁盘`。目前hash视频已经使用了全部磁盘性能，几百兆的文件要秒级。
* 2019-11-23, 现在先搁置磁盘瓶颈导致hash慢的问题。想一下如何发布。
    * 磁盘瓶颈这个可以之后做细分，如每次就扫描一点，多次更新仓库。
    * 发布这个目前受限于grpc，可能要定时的向服务器推送自己的状态。然后建立长连接

## 工作计划

* 网络订阅发布
* web端可视化管理，类似vuecli的webui